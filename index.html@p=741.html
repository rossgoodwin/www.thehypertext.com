<!DOCTYPE html>
<html lang="en-US">
	<head>
	    <link href='http://fonts.googleapis.com/css?family=Cousine|Open+Sans:400italic,700italic,400,700' rel='stylesheet' type='text/css'>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>THE HYPERTEXT</title>
		<meta http-equiv="Content-language" content="en-US" />
		<link rel="profile" href="http://gmpg.org/xfn/11" />
		<link rel="shortcut icon" href="wp-content/themes/sight/images/favico.ico" type="image/x-icon" />
		<script type='text/javascript'>function ctSetCookie(c_name, value, def_value){document.cookie = c_name + '=' + escape(value) + '; path=/';}ctSetCookie('ct_checkjs', '197926104', '0');</script><link rel='dns-prefetch' href='http://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="THE HYPERTEXT &raquo; Feed" href="feed/index.html" />
<link rel='stylesheet' id='crayon-css'  href='wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css@ver=_2.7.2_beta.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-classic-css'  href='wp-content/plugins/crayon-syntax-highlighter/themes/classic/classic.css@ver=_2.7.2_beta.css' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-monaco-css'  href='wp-content/plugins/crayon-syntax-highlighter/fonts/monaco.css@ver=_2.7.2_beta.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css'  href='wp-includes/css/dist/block-library/style.min.css@ver=5.0.4.css' type='text/css' media='all' />
<link rel='stylesheet' id='sight-style-css'  href='wp-content/themes/sight/style.css@ver=5.0.4.css' type='text/css' media='all' />
<!--[if IE]>
<link rel='stylesheet' id='sight-ie-css'  href='http://www.thehypertext.com/wp-content/themes/sight/ie.css?ver=20131217' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='wp-includes/js/jquery/jquery.js@ver=1.12.4'></script>
<script type='text/javascript' src='wp-includes/js/jquery/jquery-migrate.min.js@ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"http:\/\/www.thehypertext.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js@ver=_2.7.2_beta'></script>
<script type='text/javascript' src='wp-content/plugins/cleantalk-spam-protect/js/apbct-public.js@ver=5.114'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var ctNocache = {"ajaxurl":"http:\/\/www.thehypertext.com\/wp-admin\/admin-ajax.php","info_flag":"","set_cookies_flag":"","blog_home":"http:\/\/www.thehypertext.com\/"};
/* ]]> */
</script>
<script type='text/javascript' src='wp-content/plugins/cleantalk-spam-protect/inc/cleantalk_nocache.js@ver=5.114'></script>
<script type='text/javascript' src='wp-content/themes/sight/js/jquery.cycle.all.min.js@ver=20131219'></script>
<script type='text/javascript' src='wp-content/themes/sight/js/jquery.cookie.js@ver=20131219'></script>
<link rel='https://api.w.org/' href='wp-json/index.html' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php@rsd" />
<link rel='prev' title='Sound Camera, Part II' href='index.html@p=733.html' />
<link rel='next' title='artificial intelligence' href='index.html@p=758.html' />
<meta name="generator" content="WordPress 5.0.4" />
<link rel="canonical" href="index.html@p=741.html" />
<link rel='shortlink' href='index.html@p=741.html' />
<link rel="alternate" type="application/json+oembed" href="wp-json/oembed/1.0/embed@url=http%253A%252F%252Fwww.thehypertext.com%252F2015%252F10%252F21%252Fsound-camera-part-iii%252F" />
<link rel="alternate" type="text/xml+oembed" href="wp-json/oembed/1.0/embed@url=http%253A%252F%252Fwww.thehypertext.com%252F2015%252F10%252F21%252Fsound-camera-part-iii%252F&amp;format=xml" />
		        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-50113889-5', 'auto');
          ga('send', 'pageview');

        </script>
	</head>
	<body class="post-template-default single single-post postid-741 single-format-standard">
		<div class="wrapper">
			<div class="header clear">
				<div class="logo">
					<p class="th_logo_titletags">&lt;title&gt;</p>
					<p class="th_logo">&nbsp;&nbsp;<a class="th_logo_link" href="index.html">THE HYPERTEXT</a></p>
					<p class="th_logo_titletags">&lt;&#47;title&gt;</p>
					<p class="th_logo_rg">&lt;&#33;-- <a class="th_logo_link" href="http://rossgoodwin.com">Ross Goodwin</a> @ <a class="th_logo_link" href="http://itp.nyu.edu">ITP</a> --&gt;</p>
				</div>

				
				<div class="search_form">
	<form method="get" id="searchform" action="index.html">
		<fieldset>
			<input name="s" type="text" onfocus="if(this.value=='Search') this.value='';" onblur="if(this.value=='') this.value='Search';" value="Search" />
			<button type="submit"></button>
		</fieldset>
	</form>
</div>

							</div>

			<div class="nav"><ul id="dd" class="dd"><li id="menu-item-617" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-617"><a href="category/fall-2015/data-personal/index.html">Data Personalization</a></li>
<li id="menu-item-619" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-619"><a href="category/fall-2015/a-to-z/index.html">Programming A to Z</a></li>
<li id="menu-item-621" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-621"><a href="category/fall-2015/temp-exp/index.html">Temporary Expert</a></li>
<li id="menu-item-620" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-620"><a href="category/fall-2015/project-dev/index.html">Project Development Studio</a></li>
<li id="menu-item-768" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-768"><a href="category/fall-2015/learning-machines/index.html">Learning Machines</a></li>
</ul></div>
			
			<!-- Container -->
			<div id="container" class="clear">
				<!-- Content -->
				<div id="content">
			
		<div class="content-title">
			<a href="category/fall-2015/project-dev/index.html" rel="category tag">Project Development Studio</a>			<a href="http://facebook.com/share.php?u=http://www.thehypertext.com/2015/10/21/sound-camera-part-iii/&amp;t=Sound+Camera%2C+Part+III" target="_blank" class="f" title="Share on Facebook"></a>
			<a href="http://twitter.com/home?status=Sound Camera, Part III http://tinyurl.com/pc2zfcl" target="_blank" class="t" title="Spread the word on Twitter"></a>
			<a href="http://digg.com/submit?phase=2&amp;url=http://www.thehypertext.com/2015/10/21/sound-camera-part-iii/&amp;title=Sound Camera, Part III" target="_blank" class="di" title="Bookmark on Del.icio.us"></a>
			<a href="http://stumbleupon.com/submit?url=http://www.thehypertext.com/2015/10/21/sound-camera-part-iii/&amp;title=Sound+Camera%2C+Part+III" target="_blank" class="su" title="Share on StumbleUpon"></a>
		</div>

		<div class="entry">
			<div class="single clear post-741 post type-post status-publish format-standard has-post-thumbnail hentry category-project-dev tag-art tag-artifical-intelligence tag-code tag-deep-learning tag-image tag-natural-language-processing tag-neural-networks tag-photography tag-physical-computing tag-programming tag-python tag-raspberry-pi tag-sound-camera tag-word-camera" id="post_741">
				<div class="post-meta">
					<h1>Sound Camera, Part III</h1>
					by <span class="post-author"><a href="author/rg/index.html" title="Posts by rg">rg</a></span> on <span class="post-date">Oct 21, 2015</span> &bull; <span>10:10 pm</span>					<a
						href="index.html@p=741.html#comments" class="post-comms">No Comments</a></div>
				<div class="post-content"><p>I completed the physical prototype of the sound camera inside the enclosure I specified in <a href="index.html@p=733.html">my prior post</a>, the Kodak Brownie Model 2.</p>
<p><a href="wp-content/uploads/2015/10/IMG_1263.jpg"><br />
</a> <a href="wp-content/uploads/2015/10/IMG_1264.jpg"><img class="aligncenter size-large wp-image-751" src="wp-content/uploads/2015/10/IMG_1264-1024x1024.jpg" alt="IMG_1264" width="610" height="610" srcset="wp-content/uploads/2015/10/IMG_1264-1024x1024.jpg 1024w, wp-content/uploads/2015/10/IMG_1264-290x290.jpg 290w, wp-content/uploads/2015/10/IMG_1264-300x300.jpg 300w, wp-content/uploads/2015/10/IMG_1264-50x50.jpg 50w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<p>I started by adding a shutter button to the top of the enclosure. I used a Cherry MX Blue mechanical keyboard switch that I had leftover from <a href="tag/stenogloves/index.html">a project last year</a>.</p>
<p><a href="wp-content/uploads/2015/10/IMG_1268.jpg"><img class="aligncenter size-large wp-image-754" src="wp-content/uploads/2015/10/IMG_1268-1024x1024.jpg" alt="IMG_1268" width="610" height="610" srcset="wp-content/uploads/2015/10/IMG_1268-1024x1024.jpg 1024w, wp-content/uploads/2015/10/IMG_1268-290x290.jpg 290w, wp-content/uploads/2015/10/IMG_1268-300x300.jpg 300w, wp-content/uploads/2015/10/IMG_1268-50x50.jpg 50w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<p>&nbsp;</p>
<p>The battery and Raspberry Pi just barely fit into the enclosure:</p>
<p><a href="wp-content/uploads/2015/10/IMG_1267.jpg"><img class="aligncenter size-large wp-image-753" src="wp-content/uploads/2015/10/IMG_1267-1024x1024.jpg" alt="IMG_1267" width="610" height="610" srcset="wp-content/uploads/2015/10/IMG_1267-1024x1024.jpg 1024w, wp-content/uploads/2015/10/IMG_1267-290x290.jpg 290w, wp-content/uploads/2015/10/IMG_1267-300x300.jpg 300w, wp-content/uploads/2015/10/IMG_1267-50x50.jpg 50w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<p><a href="wp-content/uploads/2015/10/IMG_1265.jpg"><img class="aligncenter size-large wp-image-752" src="wp-content/uploads/2015/10/IMG_1265-1024x1024.jpg" alt="IMG_1265" width="610" height="610" srcset="wp-content/uploads/2015/10/IMG_1265-1024x1024.jpg 1024w, wp-content/uploads/2015/10/IMG_1265-290x290.jpg 290w, wp-content/uploads/2015/10/IMG_1265-300x300.jpg 300w, wp-content/uploads/2015/10/IMG_1265-50x50.jpg 50w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<p>&nbsp;</p>
<p>The Raspberry Pi camera module is wedged snugly beneath the camera&#8217;s front plate:</p>
<p><a href="wp-content/uploads/2015/10/IMG_1263.jpg"><img class="aligncenter size-large wp-image-750" src="wp-content/uploads/2015/10/IMG_1263-1024x1024.jpg" alt="IMG_1263" width="610" height="610" srcset="wp-content/uploads/2015/10/IMG_1263-1024x1024.jpg 1024w, wp-content/uploads/2015/10/IMG_1263-290x290.jpg 290w, wp-content/uploads/2015/10/IMG_1263-300x300.jpg 300w, wp-content/uploads/2015/10/IMG_1263-50x50.jpg 50w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<p>&nbsp;</p>
<p>In additional to playing the song, I added some functionality that provides a bit of context to the user. Using the <a href="http://manpages.ubuntu.com/manpages/oneiric/man1/pico2wave.1.html">pico2wave</a> text-to-speech utility, the camera speaks the tags aloud before playing the song. Additionally, using <a href="http://sox.sourceforge.net/">SoX</a>, the camera plays an initialization tone generated from the color histogram of the image before reading the tags.</p>
<p>Here&#8217;s the code that&#8217;s currently running on the Raspberry Pi:</p><!-- Crayon Syntax Highlighter v_2.7.2_beta -->

		<div id="crayon-5d4ba57beffdc196718198" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style=" margin-top: 12px; margin-bottom: 12px; font-size: 12px !important; line-height: 15px !important;">
		
			<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><span class="crayon-title">soundcamera.py</span>
			<div class="crayon-tools" style="font-size: 12px !important;height: 18px !important; line-height: 18px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Python</span></div></div>
			<div class="crayon-info" style="min-height: 16.8px !important; line-height: 16.8px !important;"></div>
			<div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 12px !important; line-height: 15px !important;">
from __future__ import unicode_literals

import os
import json
import uuid
import time
from random import choice as rc
from random import sample as rs
import re
import subprocess

import RPi.GPIO as GPIO
import picamera
from clarifai.client import ClarifaiApi
import requests
from PIL import Image

import sys
import threading

import spotify

import genius_token

# SPOTIFY STUFF

# Assuming a spotify_appkey.key in the current dir
session = spotify.Session()

# Process events in the background
loop = spotify.EventLoop(session)
loop.start()

# Connect an audio sink
audio = spotify.AlsaSink(session)

# Events for coordination
logged_in = threading.Event()
logged_out = threading.Event()
end_of_track = threading.Event()

logged_out.set()


def on_connection_state_updated(session):
    if session.connection.state is spotify.ConnectionState.LOGGED_IN:
        logged_in.set()
        logged_out.clear()
    elif session.connection.state is spotify.ConnectionState.LOGGED_OUT:
        logged_in.clear()
        logged_out.set()


def on_end_of_track(self):
    end_of_track.set()

# Register event listeners
session.on(
    spotify.SessionEvent.CONNECTION_STATE_UPDATED, on_connection_state_updated)
session.on(spotify.SessionEvent.END_OF_TRACK, on_end_of_track)

# Assuming a previous login with remember_me=True and a proper logout
# session.relogin()
# session.login(genius_token.spotify_un, genius_token.spotify_pwd, remember_me=True)

# logged_in.wait()

# CAMERA STUFF

# Init Camera
camera = picamera.PiCamera()

# Init GPIO
GPIO.setmode(GPIO.BCM)

# Button Pin
GPIO.setup(18, GPIO.IN, pull_up_down=GPIO.PUD_UP)

IMGPATH = '/home/pi/soundcamera/img/'

clarifai_api = ClarifaiApi()

def chunks(l, n):
    """Yield successive n-sized chunks from l."""
    for i in xrange(0, len(l), n):
        yield l[i:i+n]

def take_photo():
    fn = str(int(time.time()))+'.jpg' # TODO: Change to timestamp hash
    fp = IMGPATH+fn
    camera.capture(fp)
    return fp

def chunks(l, n):
    """Yield successive n-sized chunks from l."""
    for i in xrange(0, len(l), n):
        yield l[i:i+n]

def get_tags(fp):
    fileObj = open(fp)
    result = clarifai_api.tag_images(fileObj)
    resultObj = result['results'][0]
    tags = resultObj['result']['tag']['classes']
    return tags

def genius_search(tags):
    access_token = genius_token.token
    payload = {
        'q': ' '.join(tags),
        'access_token': access_token
    }
    endpt = 'http://api.genius.com/search'
    response = requests.get(endpt, params=payload)
    results = response.json()
    hits = results['response']['hits']
    
    artists_titles = []
    
    for h in hits:
        hit_result = h['result']
        if hit_result['url'].endswith('lyrics'):
            artists_titles.append(
                (hit_result['primary_artist']['name'], hit_result['title'])
            )
    
    return artists_titles

def spotify_search(query):
    endpt = "https://api.spotify.com/v1/search"
    payload = {
        'q': query,
        'type': 'track'
    }
    response = requests.get(endpt, params=payload)
    result = response.json()
    result_zero = result['tracks']['items'][0]
    
    return result_zero['uri']

def main(fn):
    tags = get_tags(fn)
    for tag_chunk in chunks(tags,3):
        artists_titles = genius_search(tag_chunk)
        for artist, title in artists_titles:
            try:
                result_uri = spotify_search(artist+' '+title)
            except IndexError:
                pass
            else:
                print tag_chunk
                byline = "%s by %s" % (title, artist)
                print byline
                to_read = ', '.join(tag_chunk) + ". " + byline
                return to_read, result_uri

def play_uri(track_uri):
    # Play a track
    # audio = spotify.AlsaSink(session)
    session.login(genius_token.spotify_un, genius_token.spotify_pwd, remember_me=True)
    logged_in.wait()
    track = session.get_track(track_uri).load()
    session.player.load(track)
    session.player.play()


def stop_track():
    session.player.play(False)
    session.player.unload()
    session.logout()
    logged_out.wait()
    audio._close()

def talk(msg):
    proc = subprocess.Popen(
        ['bash', '/home/pi/soundcamera/play_text.sh', msg]
    )
    proc.communicate()

def play_tone(freqs):
    freq1, freq2 = freqs
    proc = subprocess.Popen(
        ['play', '-n', 'synth', '0.25', 'saw', "%i-%i" % (freq1, freq2)]
    )
    proc.communicate()

def histo_tone(fp):
    im = Image.open(fp)
    hist = im.histogram()
    vals = map(sum, chunks(hist, 64)) # list of 12 values
    print vals
    map(play_tone, chunks(vals,2))

if __name__ == "__main__":
    input_state = True
    new_state = True
    hold_counter = 0
    while 1:
        input_state = GPIO.input(18)
        if not (input_state and new_state):
            talk("capturing")

            # Hold for 15 seconds to turn off
            while not GPIO.input(18):
                time.sleep(0.1)
                hold_counter += 1
                if hold_counter &gt; 150:
                    os.system('shutdown now -h')
                    sys.exit()

            # Reset hold counter
            hold_counter = 0

            # Else take photo
            try:
                img_fp = take_photo()
                msg, uri = main(img_fp)
                histo_tone(img_fp)
                talk(msg)
                play_uri(uri)
            except:
                print sys.exc_info()

            # Wait for playback to complete or Ctrl+C
            try:
                while not end_of_track.wait(0.1):
                    # If new photo, play new song
                    new_state = GPIO.input(18)
                    if not new_state:
                        stop_track()
                        # time.sleep(2)
                        break
            except KeyboardInterrupt:
                pass</textarea></div>
			<div class="crayon-main" style=" max-height: 500px;">
				<table class="crayon-table">
					<tr class="crayon-row">
				<td class="crayon-nums " data-settings="show">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-2">2</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-4">4</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-6">6</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-8">8</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-10">10</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-12">12</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-14">14</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-16">16</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-18">18</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-20">20</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-22">22</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-24">24</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-26">26</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-28">28</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-30">30</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-32">32</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-34">34</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-36">36</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-38">38</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-40">40</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-42">42</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-44">44</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-46">46</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-48">48</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-50">50</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-52">52</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-54">54</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-56">56</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-58">58</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-60">60</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-62">62</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-64">64</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-66">66</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-68">68</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-70">70</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-72">72</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-74">74</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-76">76</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-78">78</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-80">80</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-82">82</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-84">84</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-86">86</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-88">88</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-90">90</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-92">92</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-94">94</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-96">96</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-98">98</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-100">100</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-102">102</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-104">104</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-106">106</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-108">108</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-110">110</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-112">112</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-114">114</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-116">116</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-117">117</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-118">118</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-119">119</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-120">120</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-121">121</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-122">122</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-123">123</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-124">124</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-125">125</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-126">126</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-127">127</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-128">128</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-129">129</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-130">130</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-131">131</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-132">132</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-133">133</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-134">134</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-135">135</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-136">136</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-137">137</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-138">138</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-139">139</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-140">140</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-141">141</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-142">142</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-143">143</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-144">144</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-145">145</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-146">146</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-147">147</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-148">148</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-149">149</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-150">150</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-151">151</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-152">152</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-153">153</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-154">154</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-155">155</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-156">156</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-157">157</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-158">158</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-159">159</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-160">160</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-161">161</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-162">162</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-163">163</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-164">164</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-165">165</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-166">166</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-167">167</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-168">168</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-169">169</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-170">170</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-171">171</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-172">172</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-173">173</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-174">174</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-175">175</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-176">176</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-177">177</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-178">178</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-179">179</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-180">180</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-181">181</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-182">182</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-183">183</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-184">184</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-185">185</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-186">186</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-187">187</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-188">188</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-189">189</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-190">190</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-191">191</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-192">192</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-193">193</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-194">194</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-195">195</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-196">196</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-197">197</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-198">198</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-199">199</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-200">200</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-201">201</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-202">202</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-203">203</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-204">204</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-205">205</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-206">206</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-207">207</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-208">208</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-209">209</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-210">210</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-211">211</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-212">212</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-213">213</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-214">214</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-215">215</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-216">216</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-217">217</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-218">218</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-219">219</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-220">220</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-221">221</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-222">222</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-223">223</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-224">224</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-225">225</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-226">226</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-227">227</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-228">228</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-229">229</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-230">230</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-231">231</div><div class="crayon-num crayon-striped-num" data-line="crayon-5d4ba57beffdc196718198-232">232</div><div class="crayon-num" data-line="crayon-5d4ba57beffdc196718198-233">233</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-1"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">__future__</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">unicode_literals</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-2">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-3"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">os</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-4"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">json</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-5"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">uuid</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-6"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">time</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-7"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">random</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">choice </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">rc</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-8"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-k ">random</span><span class="crayon-h"> </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">sample </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">rs</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-9"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">re</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-10"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">subprocess</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-12"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">RPi</span><span class="crayon-sy">.</span><span class="crayon-e">GPIO </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">GPIO</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-13"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">picamera</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-14"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-v">clarifai</span><span class="crayon-sy">.</span><span class="crayon-e">client </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">ClarifaiApi</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-15"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">requests</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-16"><span class="crayon-st">from</span><span class="crayon-h"> </span><span class="crayon-e">PIL </span><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">Image</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-17">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-18"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">sys</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-19"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-k ">threading</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-20">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-21"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-e">spotify</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-22">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-23"><span class="crayon-r">import</span><span class="crayon-h"> </span><span class="crayon-v">genius_token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-24">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-25"><span class="crayon-c"># SPOTIFY STUFF</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-26">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-27"><span class="crayon-c"># Assuming a spotify_appkey.key in the current dir</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-28"><span class="crayon-v">session</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-e">Session</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-29">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-30"><span class="crayon-c"># Process events in the background</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-31"><span class="crayon-v">loop</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-e">EventLoop</span><span class="crayon-sy">(</span><span class="crayon-v">session</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-32"><span class="crayon-v">loop</span><span class="crayon-sy">.</span><span class="crayon-e">start</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-33">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-34"><span class="crayon-c"># Connect an audio sink</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-35"><span class="crayon-v">audio</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-e">AlsaSink</span><span class="crayon-sy">(</span><span class="crayon-v">session</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-36">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-37"><span class="crayon-c"># Events for coordination</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-38"><span class="crayon-v">logged_in</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">threading</span><span class="crayon-sy">.</span><span class="crayon-e">Event</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-39"><span class="crayon-v">logged_out</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">threading</span><span class="crayon-sy">.</span><span class="crayon-e">Event</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-40"><span class="crayon-v">end_of_track</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">threading</span><span class="crayon-sy">.</span><span class="crayon-e">Event</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-41">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-42"><span class="crayon-v">logged_out</span><span class="crayon-sy">.</span><span class="crayon-k ">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-43">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-44">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-45"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">on_connection_state_updated</span><span class="crayon-sy">(</span><span class="crayon-v">session</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-46"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">state </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-v">ConnectionState</span><span class="crayon-sy">.</span><span class="crayon-v">LOGGED_IN</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logged_in</span><span class="crayon-sy">.</span><span class="crayon-k ">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logged_out</span><span class="crayon-sy">.</span><span class="crayon-e">clear</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">elif</span><span class="crayon-h"> </span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">connection</span><span class="crayon-sy">.</span><span class="crayon-e">state </span><span class="crayon-st">is</span><span class="crayon-h"> </span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-v">ConnectionState</span><span class="crayon-sy">.</span><span class="crayon-v">LOGGED_OUT</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-50"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logged_in</span><span class="crayon-sy">.</span><span class="crayon-e">clear</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logged_out</span><span class="crayon-sy">.</span><span class="crayon-k ">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-52">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-53">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-54"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">on_end_of_track</span><span class="crayon-sy">(</span><span class="crayon-r">self</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">end_of_track</span><span class="crayon-sy">.</span><span class="crayon-k ">set</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-56">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-57"><span class="crayon-c"># Register event listeners</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-58"><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-v">SessionEvent</span><span class="crayon-sy">.</span><span class="crayon-v">CONNECTION_STATE_UPDATED</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">on_connection_state_updated</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-60"><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">on</span><span class="crayon-sy">(</span><span class="crayon-v">spotify</span><span class="crayon-sy">.</span><span class="crayon-v">SessionEvent</span><span class="crayon-sy">.</span><span class="crayon-v">END_OF_TRACK</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">on_end_of_track</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-61">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-62"><span class="crayon-c"># Assuming a previous login with remember_me=True and a proper logout</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-63"><span class="crayon-c"># session.relogin()</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-64"><span class="crayon-c"># session.login(genius_token.spotify_un, genius_token.spotify_pwd, remember_me=True)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-65">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-66"><span class="crayon-c"># logged_in.wait()</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-67">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-68"><span class="crayon-c"># CAMERA STUFF</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-69">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-70"><span class="crayon-c"># Init Camera</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-71"><span class="crayon-v">camera</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">picamera</span><span class="crayon-sy">.</span><span class="crayon-e">PiCamera</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-72">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-73"><span class="crayon-c"># Init GPIO</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-74"><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-e">setmode</span><span class="crayon-sy">(</span><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-v">BCM</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-75">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-76"><span class="crayon-c"># Button Pin</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-77"><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-e">setup</span><span class="crayon-sy">(</span><span class="crayon-cn">18</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-st">IN</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">pull_up_down</span><span class="crayon-o">=</span><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-v">PUD_UP</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-78">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-79"><span class="crayon-v">IMGPATH</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'/home/pi/soundcamera/img/'</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-80">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-81"><span class="crayon-v">clarifai_api</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">ClarifaiApi</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-82">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-83"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">chunks</span><span class="crayon-sy">(</span><span class="crayon-v">l</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"""Yield successive n-sized chunks from l."""</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">l</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">yield</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">n</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-87">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-88"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">take_photo</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-89"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">fn</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">str</span><span class="crayon-sy">(</span><span class="crayon-k ">int</span><span class="crayon-sy">(</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-k ">time</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-o">+</span><span class="crayon-s">'.jpg'</span><span class="crayon-h"> </span><span class="crayon-c"># TODO: Change to timestamp hash</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-90"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">fp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">IMGPATH</span><span class="crayon-o">+</span><span class="crayon-e">fn</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-91"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">camera</span><span class="crayon-sy">.</span><span class="crayon-e">capture</span><span class="crayon-sy">(</span><span class="crayon-v">fp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-92"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">fp</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-93">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-94"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">chunks</span><span class="crayon-sy">(</span><span class="crayon-v">l</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">"""Yield successive n-sized chunks from l."""</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-96"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">i</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-k ">xrange</span><span class="crayon-sy">(</span><span class="crayon-cn">0</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-k ">len</span><span class="crayon-sy">(</span><span class="crayon-v">l</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">n</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">yield</span><span class="crayon-h"> </span><span class="crayon-v">l</span><span class="crayon-sy">[</span><span class="crayon-v">i</span><span class="crayon-o">:</span><span class="crayon-v">i</span><span class="crayon-o">+</span><span class="crayon-v">n</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-98">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-99"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">get_tags</span><span class="crayon-sy">(</span><span class="crayon-v">fp</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">fileObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-v">fp</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">clarifai_api</span><span class="crayon-sy">.</span><span class="crayon-e">tag_images</span><span class="crayon-sy">(</span><span class="crayon-v">fileObj</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">resultObj</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-s">'results'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">resultObj</span><span class="crayon-sy">[</span><span class="crayon-s">'result'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'tag'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'classes'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">tags</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-105">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-106"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">genius_search</span><span class="crayon-sy">(</span><span class="crayon-v">tags</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">access_token</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">genius_token</span><span class="crayon-sy">.</span><span class="crayon-k ">token</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-108"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">payload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'q'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tags</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'access_token'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">access</span><span class="crayon-sy">_</span>token</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">endpt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">'http://api.genius.com/search'</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">endpt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-o">=</span><span class="crayon-v">payload</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">results</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-115"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hits</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">results</span><span class="crayon-sy">[</span><span class="crayon-s">'response'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'hits'</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-116"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-117"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">artists_titles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-118"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-119"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-i">h</span><span class="crayon-h"> </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">hits</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-120"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hit_result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">h</span><span class="crayon-sy">[</span><span class="crayon-s">'result'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-121"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">hit_result</span><span class="crayon-sy">[</span><span class="crayon-s">'url'</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-e">endswith</span><span class="crayon-sy">(</span><span class="crayon-s">'lyrics'</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-122"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">artists_titles</span><span class="crayon-sy">.</span><span class="crayon-e">append</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-123"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">(</span><span class="crayon-v">hit_result</span><span class="crayon-sy">[</span><span class="crayon-s">'primary_artist'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'name'</span><span class="crayon-sy">]</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">hit_result</span><span class="crayon-sy">[</span><span class="crayon-s">'title'</span><span class="crayon-sy">]</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-124"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-125"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-126"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-e">artists_titles</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-127">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-128"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">spotify_search</span><span class="crayon-sy">(</span><span class="crayon-v">query</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-129"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">endpt</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"https://api.spotify.com/v1/search"</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-130"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">payload</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-sy">{</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-131"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'q'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-v">query</span><span class="crayon-sy">,</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-132"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'type'</span><span class="crayon-o">:</span><span class="crayon-h"> </span><span class="crayon-s">'track'</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-133"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">}</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-134"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">response</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">requests</span><span class="crayon-sy">.</span><span class="crayon-e">get</span><span class="crayon-sy">(</span><span class="crayon-v">endpt</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">params</span><span class="crayon-o">=</span><span class="crayon-v">payload</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-135"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">response</span><span class="crayon-sy">.</span><span class="crayon-k ">json</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-136"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result_zero</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">result</span><span class="crayon-sy">[</span><span class="crayon-s">'tracks'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-s">'items'</span><span class="crayon-sy">]</span><span class="crayon-sy">[</span><span class="crayon-cn">0</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-137"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-138"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">result_zero</span><span class="crayon-sy">[</span><span class="crayon-s">'uri'</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-139">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-140"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-v">fn</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-141"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">tags</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">get_tags</span><span class="crayon-sy">(</span><span class="crayon-v">fn</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-142"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">tag_chunk </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">chunks</span><span class="crayon-sy">(</span><span class="crayon-v">tags</span><span class="crayon-sy">,</span><span class="crayon-cn">3</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-143"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">artists_titles</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">genius_search</span><span class="crayon-sy">(</span><span class="crayon-v">tag_chunk</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-144"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-v">artist</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">title </span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-v">artists_titles</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-145"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-146"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">result_uri</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">spotify_search</span><span class="crayon-sy">(</span><span class="crayon-v">artist</span><span class="crayon-o">+</span><span class="crayon-s">' '</span><span class="crayon-o">+</span><span class="crayon-v">title</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-147"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-k ">IndexError</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-148"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">pass</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-149"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">else</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-150"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-e">tag_chunk</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-151"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">byline</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">"%s by %s"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">title</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">artist</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-152"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-e">byline</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-153"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">to_read</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-s">', '</span><span class="crayon-sy">.</span><span class="crayon-e">join</span><span class="crayon-sy">(</span><span class="crayon-v">tag_chunk</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-s">". "</span><span class="crayon-h"> </span><span class="crayon-o">+</span><span class="crayon-h"> </span><span class="crayon-e">byline</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-154"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">return</span><span class="crayon-h"> </span><span class="crayon-v">to_read</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">result_uri</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-155">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-156"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">play_uri</span><span class="crayon-sy">(</span><span class="crayon-v">track_uri</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-157"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Play a track</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-158"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># audio = spotify.AlsaSink(session)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-159"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">login</span><span class="crayon-sy">(</span><span class="crayon-v">genius_token</span><span class="crayon-sy">.</span><span class="crayon-v">spotify_un</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">genius_token</span><span class="crayon-sy">.</span><span class="crayon-v">spotify_pwd</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">remember_me</span><span class="crayon-o">=</span><span class="crayon-t">True</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-160"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logged_in</span><span class="crayon-sy">.</span><span class="crayon-e">wait</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-161"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">track</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">get_track</span><span class="crayon-sy">(</span><span class="crayon-v">track_uri</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-162"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">player</span><span class="crayon-sy">.</span><span class="crayon-e">load</span><span class="crayon-sy">(</span><span class="crayon-v">track</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-163"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">player</span><span class="crayon-sy">.</span><span class="crayon-e">play</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-164">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-165">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-166"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">stop_track</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-167"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">player</span><span class="crayon-sy">.</span><span class="crayon-e">play</span><span class="crayon-sy">(</span><span class="crayon-t">False</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-168"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-v">player</span><span class="crayon-sy">.</span><span class="crayon-e">unload</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-169"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">session</span><span class="crayon-sy">.</span><span class="crayon-e">logout</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-170"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">logged_out</span><span class="crayon-sy">.</span><span class="crayon-e">wait</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-171"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">audio</span><span class="crayon-sy">.</span><span class="crayon-e">_close</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-172">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-173"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">talk</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-174"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">proc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">subprocess</span><span class="crayon-sy">.</span><span class="crayon-e">Popen</span><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-175"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">'bash'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'/home/pi/soundcamera/play_text.sh'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">msg</span><span class="crayon-sy">]</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-176"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-177"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">proc</span><span class="crayon-sy">.</span><span class="crayon-e">communicate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-178">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-179"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">play_tone</span><span class="crayon-sy">(</span><span class="crayon-v">freqs</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-180"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">freq1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">freq2</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">freqs</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-181"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">proc</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">subprocess</span><span class="crayon-sy">.</span><span class="crayon-e">Popen</span><span class="crayon-sy">(</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-182"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">[</span><span class="crayon-s">'play'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'-n'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'synth'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'0.25'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">'saw'</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-s">"%i-%i"</span><span class="crayon-h"> </span><span class="crayon-o">%</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-v">freq1</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">freq2</span><span class="crayon-sy">)</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-183"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-184"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">proc</span><span class="crayon-sy">.</span><span class="crayon-e">communicate</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-185">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-186"><span class="crayon-r">def</span><span class="crayon-h"> </span><span class="crayon-e">histo_tone</span><span class="crayon-sy">(</span><span class="crayon-v">fp</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-187"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">im</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">Image</span><span class="crayon-sy">.</span><span class="crayon-k ">open</span><span class="crayon-sy">(</span><span class="crayon-v">fp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-188"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hist</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">im</span><span class="crayon-sy">.</span><span class="crayon-e">histogram</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-189"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">vals</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-k ">map</span><span class="crayon-sy">(</span><span class="crayon-k ">sum</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">chunks</span><span class="crayon-sy">(</span><span class="crayon-v">hist</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">64</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-c"># list of 12 values</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-190"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-e">vals</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-191"><span class="crayon-e">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">map</span><span class="crayon-sy">(</span><span class="crayon-v">play_tone</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">chunks</span><span class="crayon-sy">(</span><span class="crayon-v">vals</span><span class="crayon-sy">,</span><span class="crayon-cn">2</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-192">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-193"><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">__name__</span><span class="crayon-h"> </span><span class="crayon-o">==</span><span class="crayon-h"> </span><span class="crayon-s">"__main__"</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-194"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">input_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-195"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">new_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-t">True</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-196"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hold_counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-197"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-198"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">input_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-k ">input</span><span class="crayon-sy">(</span><span class="crayon-cn">18</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-199"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-e">input_state </span><span class="crayon-st">and</span><span class="crayon-h"> </span><span class="crayon-v">new_state</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-200"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">talk</span><span class="crayon-sy">(</span><span class="crayon-s">"capturing"</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-201">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-202"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Hold for 15 seconds to turn off</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-203"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-k ">input</span><span class="crayon-sy">(</span><span class="crayon-cn">18</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-204"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">time</span><span class="crayon-sy">.</span><span class="crayon-e">sleep</span><span class="crayon-sy">(</span><span class="crayon-cn">0.1</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-205"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hold_counter</span><span class="crayon-h"> </span><span class="crayon-o">+=</span><span class="crayon-h"> </span><span class="crayon-cn">1</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-206"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-v">hold_counter</span><span class="crayon-h"> </span><span class="crayon-o">&gt;</span><span class="crayon-h"> </span><span class="crayon-cn">150</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-207"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">os</span><span class="crayon-sy">.</span><span class="crayon-e">system</span><span class="crayon-sy">(</span><span class="crayon-s">'shutdown now -h'</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-208"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">sys</span><span class="crayon-sy">.</span><span class="crayon-e">exit</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-209">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-210"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Reset hold counter</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-211"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">hold_counter</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-cn">0</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-212">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-213"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Else take photo</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-214"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-215"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">img_fp</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">take_photo</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-216"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">msg</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">uri</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-e">main</span><span class="crayon-sy">(</span><span class="crayon-v">img_fp</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-217"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">histo_tone</span><span class="crayon-sy">(</span><span class="crayon-v">img_fp</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-218"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">talk</span><span class="crayon-sy">(</span><span class="crayon-v">msg</span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-219"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">play_uri</span><span class="crayon-sy">(</span><span class="crayon-v">uri</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-220"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">except</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-221"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k ">print</span><span class="crayon-h"> </span><span class="crayon-k ">sys</span><span class="crayon-sy">.</span><span class="crayon-e">exc_info</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-222">&nbsp;</div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-223"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># Wait for playback to complete or Ctrl+C</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-224"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">try</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-225"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">while</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">end_of_track</span><span class="crayon-sy">.</span><span class="crayon-e">wait</span><span class="crayon-sy">(</span><span class="crayon-cn">0.1</span><span class="crayon-sy">)</span><span class="crayon-o">:</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-226"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># If new photo, play new song</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-227"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-v">new_state</span><span class="crayon-h"> </span><span class="crayon-o">=</span><span class="crayon-h"> </span><span class="crayon-v">GPIO</span><span class="crayon-sy">.</span><span class="crayon-k ">input</span><span class="crayon-sy">(</span><span class="crayon-cn">18</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-228"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">if</span><span class="crayon-h"> </span><span class="crayon-st">not</span><span class="crayon-h"> </span><span class="crayon-v">new_state</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-229"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-e">stop_track</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-230"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c"># time.sleep(2)</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-231"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">break</span></div><div class="crayon-line crayon-striped-line" id="crayon-5d4ba57beffdc196718198-232"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-st">except</span><span class="crayon-h"> </span><span class="crayon-k ">KeyboardInterrupt</span><span class="crayon-o">:</span></div><div class="crayon-line" id="crayon-5d4ba57beffdc196718198-233"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">pass</span></div></div></td>
					</tr>
				</table>
			</div>
		</div>
<!-- [Format Time: 0.0561 seconds] -->
<p>&nbsp;</p>
</div>
				<div class="post-footer"><strong>Tags: </strong><a href="tag/art/index.html" rel="tag">art</a>, <a href="tag/artifical-intelligence/index.html" rel="tag">artifical intelligence</a>, <a href="tag/code/index.html" rel="tag">code</a>, <a href="tag/deep-learning/index.html" rel="tag">deep learning</a>, <a href="tag/image/index.html" rel="tag">image</a>, <a href="tag/natural-language-processing/index.html" rel="tag">natural language processing</a>, <a href="tag/neural-networks/index.html" rel="tag">neural networks</a>, <a href="tag/photography/index.html" rel="tag">photography</a>, <a href="tag/physical-computing/index.html" rel="tag">physical computing</a>, <a href="tag/programming/index.html" rel="tag">programming</a>, <a href="tag/python/index.html" rel="tag">python</a>, <a href="tag/raspberry-pi/index.html" rel="tag">raspberry pi</a>, <a href="tag/sound-camera/index.html" rel="tag">sound camera</a>, <a href="tag/word-camera/index.html" rel="tag">word.camera</a></div>
							</div>
			<div class="post-navigation clear">
															<a class="post-prev" href="index.html@p=733.html"><em>Previous post</em><span>Sound Camera, Part II</span></a>
																<a class="post-next" href="index.html@p=758.html"><em>Next post</em><span>artificial intelligence</span></a>
									<div class="line"></div>
			</div>
		</div>

			

			</div>
			<!-- /Content -->

			<div class="sidebar">
    <div id="text-3" class="widget_text widget"><h3>About</h3><div class="widget-body clear">			
    <div class="textwidget"><p><img src="wp-content/uploads/2014/08/selfportrait_200px.jpg" alt="self portrait" width=200 /></p>
    <p><br></p>
    <p>My name is <a href="http://rossgoodwin.com">Ross Goodwin</a>. I am a creative technologist, data scientist, artist, and MPS candidate at NYU Tisch ITP. Before attending ITP, I was a ghostwriter in the Obama administration, then became interested in computer code and natural language processing. I earned my BS in economics from MIT in 2009.</p>
    <p><br></p>
    <p>This blog will consist (almost) entirely of ITP related projects &amp; work in progress.</p>
    </div>
    </div>
    </div>
	<div id="text-5" class="widget_text widget">
	    <h3>Twitter</h3>
	    <a class="twitter-timeline" href="https://twitter.com/rossgoodwin" data-widget-id="641439634627633152">Tweets by @rossgoodwin</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	</div>
	<div id="archives-7" class="widget_archive widget"><h3>Archive</h3><div class="widget-body clear">		<ul>
			<li><a href='2015/12/index.html'>December 2015</a>&nbsp;(2)</li>
	<li><a href='2015/11/index.html'>November 2015</a>&nbsp;(1)</li>
	<li><a href='2015/10/index.html'>October 2015</a>&nbsp;(5)</li>
	<li><a href='2015/09/index.html'>September 2015</a>&nbsp;(5)</li>
	<li><a href='2015/05/index.html'>May 2015</a>&nbsp;(2)</li>
	<li><a href='2015/04/index.html'>April 2015</a>&nbsp;(2)</li>
	<li><a href='2015/03/index.html'>March 2015</a>&nbsp;(1)</li>
	<li><a href='2015/02/index.html'>February 2015</a>&nbsp;(2)</li>
	<li><a href='2015/01/index.html'>January 2015</a>&nbsp;(1)</li>
	<li><a href='2014/12/index.html'>December 2014</a>&nbsp;(4)</li>
	<li><a href='2014/11/index.html'>November 2014</a>&nbsp;(5)</li>
	<li><a href='2014/10/index.html'>October 2014</a>&nbsp;(4)</li>
	<li><a href='2014/09/index.html'>September 2014</a>&nbsp;(7)</li>
	<li><a href='2014/08/index.html'>August 2014</a>&nbsp;(2)</li>
		</ul>
		</div></div><div id="categories-6" class="widget_categories widget"><h3>Categories</h3><div class="widget-body clear">		<ul>
	<li class="cat-item cat-item-33"><a href="category/fall-2014/index.html" title="ITP Courses Fall 2014">Fall 2014</a> (18)
<ul class='children'>
	<li class="cat-item cat-item-6"><a href="category/fall-2014/applications/index.html" title="Applications">Applications</a> (1)
</li>
	<li class="cat-item cat-item-5"><a href="category/fall-2014/automata/index.html" title="Automata: Telling Stories With Machines">Automata</a> (6)
</li>
	<li class="cat-item cat-item-4"><a href="category/fall-2014/cmedia/index.html" title="Introduction to Computational Media">Computational Media</a> (8)
</li>
	<li class="cat-item cat-item-7"><a href="category/fall-2014/network/index.html" title="Comm Lab: Networked Media">Networked Media</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="category/fall-2014/pcomp/index.html" title="Introduction to Physical Computing">Physical Computing</a> (6)
</li>
</ul>
</li>
	<li class="cat-item cat-item-160"><a href="category/fall-2015/index.html" title="ITP Courses Fall 2015">Fall 2015</a> (13)
<ul class='children'>
	<li class="cat-item cat-item-165"><a href="category/fall-2015/data-personal/index.html" title="Designing for Data Personalization">Data Personalization</a> (4)
</li>
	<li class="cat-item cat-item-164"><a href="category/fall-2015/learning-machines/index.html" title="Learning Machines">Learning Machines</a> (2)
</li>
	<li class="cat-item cat-item-162"><a href="category/fall-2015/a-to-z/index.html" title="Programming A to Z">Programming A to Z</a> (2)
</li>
	<li class="cat-item cat-item-161"><a href="category/fall-2015/project-dev/index.html" title="Project Development Studio">Project Development Studio</a> (6)
</li>
	<li class="cat-item cat-item-163"><a href="category/fall-2015/temp-exp/index.html" title="Temporary Expert">Temporary Expert</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-119"><a href="category/spring-2015/index.html" title="ITP Courses Spring 2015">Spring 2015</a> (6)
<ul class='children'>
	<li class="cat-item cat-item-121"><a href="category/spring-2015/convo-comp/index.html" title="Conversation and Computation">Convo Comp</a> (3)
</li>
	<li class="cat-item cat-item-153"><a href="category/spring-2015/remix/index.html" title="this is the remix">Remix</a> (1)
</li>
	<li class="cat-item cat-item-120"><a href="category/spring-2015/sculpting-data/index.html" title="Sculpting Data Into Everyday Objects">Sculpting Data</a> (2)
</li>
	<li class="cat-item cat-item-122"><a href="category/spring-2015/storage-wars/index.html" title="Storage Wars: Narrating Data Archives">Storage Wars</a> (1)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="category/uncategorized/index.html" >Uncategorized</a> (7)
</li>
		</ul>
</div></div><div id="tag_cloud-5" class="widget_tag_cloud widget"><h3>Tags</h3><div class="widget-body clear"><div class="tagcloud"><a href="tag/3d/index.html" class="tag-cloud-link tag-link-84 tag-link-position-1" style="font-size: 9.6153846153846pt;" aria-label="3d (3 items)">3d</a>
<a href="tag/arduino/index.html" class="tag-cloud-link tag-link-66 tag-link-position-2" style="font-size: 14.326923076923pt;" aria-label="arduino (8 items)">arduino</a>
<a href="tag/art/index.html" class="tag-cloud-link tag-link-17 tag-link-position-3" style="font-size: 21.192307692308pt;" aria-label="art (28 items)">art</a>
<a href="tag/artifical-intelligence/index.html" class="tag-cloud-link tag-link-12 tag-link-position-4" style="font-size: 16.480769230769pt;" aria-label="artifical intelligence (12 items)">artifical intelligence</a>
<a href="tag/artificial-intelligence/index.html" class="tag-cloud-link tag-link-145 tag-link-position-5" style="font-size: 10.961538461538pt;" aria-label="artificial intelligence (4 items)">artificial intelligence</a>
<a href="tag/automata-2/index.html" class="tag-cloud-link tag-link-52 tag-link-position-6" style="font-size: 12.980769230769pt;" aria-label="automata (6 items)">automata</a>
<a href="tag/chess/index.html" class="tag-cloud-link tag-link-51 tag-link-position-7" style="font-size: 12.038461538462pt;" aria-label="chess (5 items)">chess</a>
<a href="tag/clarifai/index.html" class="tag-cloud-link tag-link-146 tag-link-position-8" style="font-size: 12.038461538462pt;" aria-label="clarifai (5 items)">clarifai</a>
<a href="tag/code/index.html" class="tag-cloud-link tag-link-15 tag-link-position-9" style="font-size: 21.596153846154pt;" aria-label="code (30 items)">code</a>
<a href="tag/code-poetry/index.html" class="tag-cloud-link tag-link-13 tag-link-position-10" style="font-size: 16.480769230769pt;" aria-label="code poetry (12 items)">code poetry</a>
<a href="tag/computational-media/index.html" class="tag-cloud-link tag-link-41 tag-link-position-11" style="font-size: 15.538461538462pt;" aria-label="computational media (10 items)">computational media</a>
<a href="tag/computer/index.html" class="tag-cloud-link tag-link-11 tag-link-position-12" style="font-size: 15pt;" aria-label="computer (9 items)">computer</a>
<a href="tag/data/index.html" class="tag-cloud-link tag-link-130 tag-link-position-13" style="font-size: 10.961538461538pt;" aria-label="data (4 items)">data</a>
<a href="tag/deep-learning/index.html" class="tag-cloud-link tag-link-186 tag-link-position-14" style="font-size: 9.6153846153846pt;" aria-label="deep learning (3 items)">deep learning</a>
<a href="tag/fiction/index.html" class="tag-cloud-link tag-link-98 tag-link-position-15" style="font-size: 13.653846153846pt;" aria-label="fiction (7 items)">fiction</a>
<a href="tag/fiction-generator/index.html" class="tag-cloud-link tag-link-101 tag-link-position-16" style="font-size: 10.961538461538pt;" aria-label="fiction generator (4 items)">fiction generator</a>
<a href="tag/flickr/index.html" class="tag-cloud-link tag-link-18 tag-link-position-17" style="font-size: 8pt;" aria-label="flickr (2 items)">flickr</a>
<a href="tag/generative/index.html" class="tag-cloud-link tag-link-16 tag-link-position-18" style="font-size: 17.019230769231pt;" aria-label="generative (13 items)">generative</a>
<a href="tag/gui/index.html" class="tag-cloud-link tag-link-69 tag-link-position-19" style="font-size: 10.961538461538pt;" aria-label="gui (4 items)">gui</a>
<a href="tag/image/index.html" class="tag-cloud-link tag-link-23 tag-link-position-20" style="font-size: 15.538461538462pt;" aria-label="image (10 items)">image</a>
<a href="tag/image-manipulation/index.html" class="tag-cloud-link tag-link-30 tag-link-position-21" style="font-size: 8pt;" aria-label="image manipulation (2 items)">image manipulation</a>
<a href="tag/interaction/index.html" class="tag-cloud-link tag-link-48 tag-link-position-22" style="font-size: 10.961538461538pt;" aria-label="interaction (4 items)">interaction</a>
<a href="tag/interactive/index.html" class="tag-cloud-link tag-link-45 tag-link-position-23" style="font-size: 16.076923076923pt;" aria-label="interactive (11 items)">interactive</a>
<a href="tag/interactivity/index.html" class="tag-cloud-link tag-link-46 tag-link-position-24" style="font-size: 10.961538461538pt;" aria-label="interactivity (4 items)">interactivity</a>
<a href="tag/itp/index.html" class="tag-cloud-link tag-link-21 tag-link-position-25" style="font-size: 16.480769230769pt;" aria-label="itp (12 items)">itp</a>
<a href="tag/keyboard/index.html" class="tag-cloud-link tag-link-93 tag-link-position-26" style="font-size: 9.6153846153846pt;" aria-label="keyboard (3 items)">keyboard</a>
<a href="tag/mechanical-turk/index.html" class="tag-cloud-link tag-link-50 tag-link-position-27" style="font-size: 12.038461538462pt;" aria-label="mechanical turk (5 items)">mechanical turk</a>
<a href="tag/mechanical-turks-ghost/index.html" class="tag-cloud-link tag-link-59 tag-link-position-28" style="font-size: 10.961538461538pt;" aria-label="mechanical turk&#039;s ghost (4 items)">mechanical turk&#039;s ghost</a>
<a href="tag/natural-language-generation/index.html" class="tag-cloud-link tag-link-35 tag-link-position-29" style="font-size: 16.076923076923pt;" aria-label="natural language generation (11 items)">natural language generation</a>
<a href="tag/natural-language-processing/index.html" class="tag-cloud-link tag-link-34 tag-link-position-30" style="font-size: 18.096153846154pt;" aria-label="natural language processing (16 items)">natural language processing</a>
<a href="tag/neural-networks/index.html" class="tag-cloud-link tag-link-184 tag-link-position-31" style="font-size: 12.038461538462pt;" aria-label="neural networks (5 items)">neural networks</a>
<a href="tag/novel-generator/index.html" class="tag-cloud-link tag-link-106 tag-link-position-32" style="font-size: 9.6153846153846pt;" aria-label="novel generator (3 items)">novel generator</a>
<a href="tag/photography/index.html" class="tag-cloud-link tag-link-19 tag-link-position-33" style="font-size: 12.980769230769pt;" aria-label="photography (6 items)">photography</a>
<a href="tag/physical-computing/index.html" class="tag-cloud-link tag-link-44 tag-link-position-34" style="font-size: 16.480769230769pt;" aria-label="physical computing (12 items)">physical computing</a>
<a href="tag/poem/index.html" class="tag-cloud-link tag-link-10 tag-link-position-35" style="font-size: 10.961538461538pt;" aria-label="poem (4 items)">poem</a>
<a href="tag/poetry/index.html" class="tag-cloud-link tag-link-9 tag-link-position-36" style="font-size: 12.980769230769pt;" aria-label="poetry (6 items)">poetry</a>
<a href="tag/processing/index.html" class="tag-cloud-link tag-link-38 tag-link-position-37" style="font-size: 15pt;" aria-label="processing (9 items)">processing</a>
<a href="tag/programming/index.html" class="tag-cloud-link tag-link-28 tag-link-position-38" style="font-size: 22pt;" aria-label="programming (32 items)">programming</a>
<a href="tag/python/index.html" class="tag-cloud-link tag-link-14 tag-link-position-39" style="font-size: 21.057692307692pt;" aria-label="python (27 items)">python</a>
<a href="tag/raspberry-pi/index.html" class="tag-cloud-link tag-link-60 tag-link-position-40" style="font-size: 15pt;" aria-label="raspberry pi (9 items)">raspberry pi</a>
<a href="tag/sound-camera/index.html" class="tag-cloud-link tag-link-183 tag-link-position-41" style="font-size: 10.961538461538pt;" aria-label="sound camera (4 items)">sound camera</a>
<a href="tag/stenographer/index.html" class="tag-cloud-link tag-link-92 tag-link-position-42" style="font-size: 9.6153846153846pt;" aria-label="stenographer (3 items)">stenographer</a>
<a href="tag/typing/index.html" class="tag-cloud-link tag-link-94 tag-link-position-43" style="font-size: 9.6153846153846pt;" aria-label="typing (3 items)">typing</a>
<a href="tag/visualization/index.html" class="tag-cloud-link tag-link-42 tag-link-position-44" style="font-size: 12.980769230769pt;" aria-label="visualization (6 items)">visualization</a>
<a href="tag/word-camera/index.html" class="tag-cloud-link tag-link-149 tag-link-position-45" style="font-size: 14.326923076923pt;" aria-label="word.camera (8 items)">word.camera</a></div>
</div></div></div>

			</div>
			<!-- /Container -->

			<div class="footer">
				<p class="copyright">&copy; 2014 <a href="index.html">THE HYPERTEXT</a>.
					All Rights Reserved.<br />
				</p>
			</div>
		</div>
		<!-- Page generated: 0.747 s, 31 queries -->
		<script type='text/javascript' src='wp-content/themes/sight/js/script.js@ver=20131219'></script>

			</body>
</html>
